{
    "tags": {
        "Name": "FIS Experiment"
    },
    "description": "Stop 3 random running instances tagged with Purpose:chaos-ready and restart them after 3 minutes. Repeat.",
    "targets": {
        "myInstance": {
            "resourceTags": {
                "Purpose": "chaos-ready"
            },
            "resourceType": "aws:ec2:instance",
            "selectionMode": "COUNT(3)"
        }
    },
    "actions": {
        "StopInstances1": {
            "actionId": "aws:ec2:stop-instances",
            "description": "stop the instances",
            "parameters": {
                "startInstancesAfterDuration": "PT3M"
            },
            "targets": {
                "Instances": "myInstance"
            }
        },
        "Wait": {
            "actionId": "aws:fis:wait",
            "description": "Wait for a while",
            "parameters": {
              "duration": "PT3M"
            },
            "startAfter": ["StopInstances1"]
        },
        "StopInstances2": {
            "actionId": "aws:ec2:stop-instances",
            "description": "stop the instances",
            "parameters": {
                "startInstancesAfterDuration": "PT3M"
            },
            "targets": {
                "Instances": "myInstance"
            },
            "startAfter": ["Wait"]
        }
    },
    "stopConditions": [
        {
            "source": "aws:cloudwatch:alarm",
            "value": "arn:aws:cloudwatch:us-east-1:<ACCOUNT_ID>:alarm:<CLOUDWATCH_ALARM>"
        }
    ],
    "roleArn": "arn:aws:iam::<ACCOUNT_ID>:role/<IAM_ROLE>"
}